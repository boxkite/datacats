machine:
  services:
    - docker
dependencies:
  post:
    - datacats pull
    - pip install -r requirements_test.txt
test:
  override:
    - datacats create site1 -bn
    - "[ ! -d site1/ckanext-site1theme ]"
    - '[ "$(echo `datacats list`)" == "site1" ]'
    - datacats info site1
    - datacats start site1 8999
    - datacats info site1
    - datacats shell site1 echo hello from inside site1
    - datacats create site2 -n
    - "[ -d site2/ckanext-site2theme ]"
    - '[ "$(echo `datacats list`)" == "site1 site2" ]'
    - datacats purge -y site1
    - '[ "$(echo `datacats list`)" == "site2" ]'
    - datacats init site1 -n
    - datacats install site1
    - python setup.py test -s datacats.tests.basic
    - "[ $(datacats --version | wc -l) == 1 ]"
